/*! LiveRefresh 2013-08-06 */
var LiveRefresh=function(a){var b={debug:!0,debug_level:0,notification_timeout:10,port:9999};this.options=a?a:{};for(var c in b)void 0===this.options[c]&&(this.options[c]=b[c]);this.init()};LiveRefresh.prototype={init:function(){var a=new WebSocket("ws://"+window.location.hostname+":"+this.options.port),b=this;a.onopen=function(a){LiveRefresh.prototype.on_open.call(b,a)},a.onclose=function(a){LiveRefresh.prototype.on_close.call(b,a)},a.onmessage=function(a){LiveRefresh.prototype.on_message.call(b,a)}},add_timer:function(){this.timer_el=document.createElement("div"),this.timer_el.style.cssText="position:absolute;font-size:10px;width:120px;text-align:center;top:10px;right:10px;background-color:#4A93DE;padding:10px;",this.timer_el.id="liverefresh_timer",this.timer_el.innerHTML="WebSocket Connected.",document.body.appendChild(this.timer_el)},update_timer:function(){enlapsed=(((new Date).getTime()-this.refresh_date)/1e3).toFixed(1),this.timer_el.innerHTML="Refreshed "+enlapsed+"s ago",this.timer_el.style.opacity=(this.options.notification_timeout-enlapsed)/this.options.notification_timeout,enlapsed>this.options.notification_timeout&&(this.timer_el.parentNode.removeChild(this.timer_el),window.clearInterval(this.timer_interval))},on_open:function(){this.debug("Websocket opened"),this.timer_el=null,this.refresh_date=(new Date).getTime(),this.add_timer();var a=this;setTimeout(function(){a.timer_interval=setInterval(function(){LiveRefresh.prototype.update_timer.call(a)},100)},300)},on_close:function(){this.debug("Websocket closed")},on_message:function(a){this.debug("Message received: "+a.data),"refresh"==a.data&&location.reload()},debug:function(){this.options.debug&&window.console&&(1==arguments.length||arguments.length>=1&&arguments[1]<=this.options.debug_level)&&console.log(arguments[0])}};